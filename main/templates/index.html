{% extends 'base.html' %}

{% block title %}
    <title>Main page</title>
    <style>
        #load-more {
            margin: 5px auto;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
        }
    </style>
{% endblock title %}
    
{% block content %}
    <div class="container mt-3 border p-5">
        <div class="row">
            <div class="col">
                <div class="px-4 py-5 my-5 text-center bg-secondary">
                    <h1 class="display-5 fw-bold">Welcome to Svepis!</h1>
                    <div class="col-lg-6 mx-auto">
                      <p class="lead mb-4">We are excited to introduce you to a new platform created as part of a school project and driven by the initiative of a young developer. Our goal is to provide a convenient, safe, and engaging space for communication, idea sharing, and creative collaboration.<br><br>
Svepis is more than just a social network. It's a place where everyone can be themselves, share their thoughts, and connect with people who share similar interests. Create posts, chat with friends, join groups, participate in discussions, and share moments of your life through stories.<br><br>
Join us and become a part of this exciting and evolving project! </p>
                    </div>
                  </div>
                
                <h1 class="d-flex justify-content-center">Whats new?</h1>
                <br>
                
                <div class="row">
                    <div class="col-12">
                        {% for ann in Announcements %}
                            <div class="container" id="announcements">
                                {% if forloop.first %}
                                    {% include 'post.html' with announcement=True display="block" pk=ann.pk first_name=ann.user.first_name last_name=ann.user.last_name username=ann.user.username date=ann.date content=ann.content %}
                                {% else %}
                                    {% include 'post.html' with announcement=True display="none" pk=ann.pk first_name=ann.user.first_name last_name=ann.user.last_name username=ann.user.username date=ann.date content=ann.content %}
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <button type="button" class="btn border border-warning" id="load-more">Load More Announcements</button>
            </div>
            
        </div>
    </div>
    
    <script>
        let offset = 0;
        
        function loadMore() {
            fetch(`/load-more-announcements/?offset=${offset}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('announcements');
                    data.announcements.forEach(item => {
                        announcementCard = document.getElementById(`announcement_${item.pk}`);
                        announcementCard.style.display = "block";
                    });

                    offset += 1;

                    console.log(data.announcements.length);

                    if (data.announcements.length < 1) {
                        document.getElementById('load-more').style.display = 'none';
                    }
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('load-more').addEventListener('click', loadMore);
        });
    </script>

{% endblock content %}